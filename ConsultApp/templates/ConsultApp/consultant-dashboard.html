{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ResearchMate â€” Consultant Dashboard</title>
  <link rel="stylesheet" href="{% static 'ConsultApp/consultant-dashboard.css'%}">
</head>
<body>
  <!-- Top Navigation -->
  <nav class="top-nav">
    <div class="logo">ResearchMate</div>
    
    <div class="nav-links">
      <a href="{% url 'consultant_dashboard' %}" class="active">ğŸ  Dashboard</a>
      <a href="{% url 'consultant_profile' %}">ğŸ‘¤ My Profile</a>
      <a href="{% url 'consultant_students' %}">ğŸ§‘â€ğŸ“ Students</a>
      <a href="{% url 'consultant_appointments' %}">ğŸ“… Appointments</a>
      <a href="#">â“ Help</a>
    </div>

    <div class="user-section">
      <span class="consultant-label" id="consultantName">{{ consultant_name }}</span>
      <form method="POST" action="{% url 'logout' %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="logout-btn">ğŸšª Logout</button>
      </form>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    <div class="page-header">
      <h1>Welcome back, <span id="welcomeName">{{ consultant_name }}</span>!</h1>
      <p>Manage your students and upcoming consultations</p>
    </div>
    {% if messages %}
      <div class="alert">
        {% for message in messages %}
          <p>{{ message }}</p>
        {% endfor %}
      </div>
    {% endif %} 
      {% if approved_verification %}
        <div class="verify-banner" style="background: #e6ffed; border-left: 4px solid #38a169;">
          <div class="text">
            <h3>âœ… Verified Consultant</h3>
            <p>Your verification was approved on {{ approved_verification.reviewed_at|date:"M d, Y" }}.</p>
          </div>
        </div>

      {% elif pending_verification %}
        <div class="verify-banner" style="background: #fffbea; border-left: 4px solid #d69e2e;">
          <div class="text">
            <h3>â³ Verification Pending</h3>
            <p>Your verification request has been submitted. Please wait for admin approval.</p>
          </div>
        </div>

      {% elif rejected_verification %}
        <div class="verify-banner" style="background: #fee; border-left: 4px solid #e53e3e;">
          <div class="text">
            <h3>âŒ Verification Rejected</h3>
            <p>Your verification request was rejected on {{ rejected_verification.reviewed_at|date:"M d, Y" }}. You can submit a new application.</p>
          </div>
          <a href="{% url 'consultant_verification' %}" class="btn-view-all">Resubmit Application</a>
        </div>

      {% else %}
        <div class="verify-banner">
          <div class="text">
            <h3>ğŸ“ Get Verified as a Consultant</h3>
            <p>Complete your verification to start accepting consultation requests.</p>
          </div>
          <a href="{% url 'consultant_verification' %}" class="btn-view-all">Verify Now</a>
        </div>
      {% endif %}

        
    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Left Column -->
      <div>
        <div class="section-card">
          <h2>ğŸ“… Upcoming Appointments</h2>
          <div class="items-grid">
            {% if appointments %}
              {% for appointment in appointments %}
                <div class="item-card">
                  <div class="avatar">
                    {{ appointment.student.full_name|slice:":2"|upper }}
                  </div>
                  <h4>{{ appointment.student.full_name }}</h4>
                  <p>{{ appointment.date|date:"M d, Y" }} â€” {{ appointment.time|time:"g:i A" }}</p>
                </div>
              {% endfor %}
            {% else %}
              <p>No upcoming appointments.</p>
            {% endif %}
          </div>
          <button class="btn-view-all" onclick="window.location.href='{% url 'consultant_appointments' %}'">View All Appointments</button>
        </div>


        <!-- Assigned Students -->
        <div class="section-card">
          <h2>ğŸ‘¥ Assigned Students</h2>
          <div class="items-grid">
            {% if students %}
              {% for student in students %}
                <div class="item-card">
                  <div class="avatar">{{ student.full_name|slice:":2"|upper }}</div>
                  <h4>{{ student.full_name }}</h4>
                  <p>Topic: {{ student.topic }}</p>
                </div>
              {% endfor %}
            {% else %}
              <p>No students assigned yet.</p>
            {% endif %}
          </div>
          <button class="btn-view-all" onclick="window.location.href='{% url 'consultant_students' %}'">View All Students</button>
        </div>


        {% comment %} <!-- Helpful Resources -->
        <div class="section-card">
          <h2>ğŸ“š Helpful Resources for Consultants</h2>
          <div class="resources-grid">
            <div class="resource-card">
              <div class="icon">ğŸ“…</div>
              <h4>Planner</h4>
              <p>Manage appointments</p>
            </div>
            <div class="resource-card" href="{% url 'consultant-reports'%}">
              <div class="icon">ğŸ“</div>
              <h4>Templates</h4>
              <p>Reports & forms</p>
            </div>
            <div class="resource-card">
              <div class="icon">ğŸ“–</div>
              <h4>Knowledge Base</h4>
              <p href="">Guidelines & tips</p>
            </div>
          </div>
        </div>  {% endcomment %}
      </div>
      <!-- Pending Appointments Section -->
<div class="section-card" style="margin-top: 20px;">
  <h2>ğŸ•’ Pending Appointments</h2>
  <div class="items-grid">
    {% if pending_appointments %}
      {% for appointment in pending_appointments %}
        <div class="item-card" style="text-align:center;">
          <h4>{{ appointment.student.user.get_full_name }}</h4>
          <p>Topic: {{ appointment.topic }}</p>
          <p>{{ appointment.date|date:"M d, Y" }} â€” {{ appointment.time|time:"g:i A" }}</p>
          <form method="POST" action="{% url 'update_appointment_status' appointment.id %}">
            {% csrf_token %}
            <button type="submit" name="action" value="approve" class="btn-view-all" style="background:#4caf50; color:white;">Approve</button>
            <button type="submit" name="action" value="reject" class="btn-view-all" style="background:#e53e3e; color:white;">Reject</button>
          </form>
        </div>
      {% endfor %}
    {% else %}
      <p>No pending appointments at the moment.</p>
    {% endif %}
  </div>
</div>


      <!-- Right Sidebar -->
      <div class="sidebar-column">
        <!-- Profile Card -->
        <div class="profile-card">
          <div class="profile-header">
            <div class="profile-avatar">
              {{ consultant_name|slice:":2"|upper }}
            </div>
            <div class="profile-name">
              <h3>{{ consultant_name }}</h3>
              {% if consultant.is_verified %}
                <span class="verified">âœ… Verified</span>
              {% endif %}
              <p>Research Consultant</p>
            </div>
          </div>
          <div class="profile-info">
            <div class="info-row">
              <span class="label">Email:</span>
              <span class="value">{{ request.user.email }}</span>
            </div>
            <div class="info-row">
              <span class="label">Contact:</span>
              <span class="value">{{ consultant.contact_number|default:"N/A" }}</span>
            </div>
            <div class="info-row">
              <span class="label">Expertise:</span>
              <span class="value">{{ consultant.expertise|default:"N/A" }}</span>
            </div>
          </div>
          <button class="btn-edit-profile" onclick="window.location.href='{% url 'consultant_profile' %}'">âœï¸ Edit Profile</button>
          {% if consultant.is_verified %}
            <button class="btn-primary" style="margin-top:16px;"
              onclick="window.location.href='{% url 'consultant_market' %}'">
              ğŸ“Œ List Yourself in Market
            </button>
          {% endif %}
        </div>
        
      </div>
    </div>
  </main>
</body>
</html>